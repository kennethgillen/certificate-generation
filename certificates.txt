# Based on
#   http://www.wahlsten.com/openssl-ca
#   http://blog.didierstevens.com/2008/12/30/howto-make-your-own-cert-with-openssl/

# Note:
# - You will be prompted for passwords multiple times.
# - The -config openssl.cnf arguments is just for convenience to avoid
#   entering all the DN (distinguished names) everytime, it can be omitted
#   from all commands.

ROOT_CA_BITS=4096
ROOT_CA_DAYS=366

INTERMEDIATE_CA_BITS=2048
INTERMEDIATE_CA_DAYS=366

SSL_SERVER_BITS=2048
SSL_SERVER_DAYS=366

# Certificate authority private key:
openssl genrsa -des3 -out ca.key $ROOT_CA_BITS

# Certificate authority certificate:
openssl req -new -x509 -key ca.key -out ca.crt -config openssl.cnf -days $ROOT_CA_DAYS

# Apache SSL certificate OR subordinate (intermediate) CA for signing:
openssl genrsa -out server-private.key $SSL_SERVER_BITS
openssl genrsa -out ia.key $INTERMEDIATE_CA_BITS

# Certificate request for SSL certificate OR for subordinate CA:
openssl req -new -key server-private.key -out server.csr -config openssl.cnf
openssl req -new -key ia.key -out ia.csr -config openssl.cnf

# Sign certificate request:
openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server-public.crt -days $SSL_SERVER_DAYS
openssl x509 -req -in ia.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out ia.crt -days $INTERMEDIATE_CA_DAYS


